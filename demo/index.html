<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>たんぼアドバイザー デモ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: "Hiragino Kaku Gothic ProN","Meiryo","Yu Gothic",sans-serif;
  background: #f5f3ee;
  color: #333;
}
.header {
  background: linear-gradient(135deg, #2d7a3a 0%, #4a9a5a 100%);
  color: white;
  padding: 20px 24px;
  text-align: center;
}
.header h1 { font-size: 22px; letter-spacing: 2px; }
.header p { font-size: 13px; margin-top: 6px; opacity: 0.9; }
.container { max-width: 1100px; margin: 0 auto; padding: 16px; }
.info-bar {
  display: flex; gap: 12px; flex-wrap: wrap;
  margin: 16px 0;
}
.info-card {
  background: white; border-radius: 10px; padding: 14px 18px;
  flex: 1; min-width: 180px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
}
.info-card .label { font-size: 11px; color: #888; }
.info-card .value { font-size: 22px; font-weight: bold; margin-top: 4px; }
.info-card .sub { font-size: 12px; color: #666; margin-top: 2px; }
.chart-panel {
  background: white; border-radius: 12px; padding: 20px;
  margin: 16px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}
.chart-panel h2 {
  font-size: 15px; color: #2d7a3a;
  border-left: 4px solid #2d7a3a;
  padding-left: 10px; margin-bottom: 14px;
}
.chart-container { position: relative; height: 280px; }
.timeline {
  margin: 16px 0;
}
.timeline h2 {
  font-size: 15px; color: #2d7a3a;
  border-left: 4px solid #2d7a3a;
  padding-left: 10px; margin-bottom: 14px;
  background: white; border-radius: 12px 12px 0 0;
  padding: 16px 18px 10px 18px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}
.notif-card {
  background: white; border-radius: 10px; padding: 14px 18px;
  margin: 8px 0;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  border-left: 5px solid #ccc;
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.15s;
}
.notif-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}
.notif-card.info    { border-left-color: #4488cc; }
.notif-card.warning { border-left-color: #cc4444; }
.notif-card.action  { border-left-color: #cc8800; }
.notif-head {
  display: flex; justify-content: space-between; align-items: center;
}
.notif-date { font-size: 12px; color: #888; }
.notif-badge {
  font-size: 10px; padding: 2px 8px; border-radius: 10px;
  color: white; font-weight: bold;
}
.notif-badge.info    { background: #4488cc; }
.notif-badge.warning { background: #cc4444; }
.notif-badge.action  { background: #cc8800; }
.notif-title {
  font-size: 15px; font-weight: bold; margin: 6px 0 4px;
}
.notif-detail {
  font-size: 13px; color: #555; line-height: 1.6;
}
.notif-acc {
  font-size: 11px; color: #999; margin-top: 4px;
}
.line-preview {
  background: #f8f8f0; border-radius: 12px; padding: 20px;
  margin: 16px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  max-width: 380px;
}
.line-preview h2 {
  font-size: 14px; color: #2d7a3a; margin-bottom: 12px;
}
.line-bubble {
  background: white; border-radius: 16px; padding: 16px;
  font-size: 14px; line-height: 1.8;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  white-space: pre-wrap;
  border: 1px solid #e8e8e0;
}
.stage-bar {
  display: flex; height: 30px; border-radius: 6px;
  overflow: hidden; margin: 16px 0;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.stage-seg {
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; color: #333; font-weight: bold;
  transition: flex 0.3s;
  white-space: nowrap; overflow: hidden;
}
.stage-seg.active {
  outline: 3px solid #333;
  outline-offset: -3px;
  z-index: 1;
}
.footer {
  text-align: center; padding: 24px; font-size: 12px; color: #999;
}
</style>
</head>
<body>

<div class="header">
  <h1>たんぼアドバイザー</h1>
  <p>水稲農家向け 圃場モニタリング + 行動提案システム デモ</p>
</div>

<div class="container">

  <!-- 概要カード -->
  <div class="info-bar" id="infoBar"></div>

  <!-- 生育ステージバー -->
  <div class="chart-panel">
    <h2>生育ステージ進行</h2>
    <div class="stage-bar" id="stageBar"></div>
    <div id="stageDetail" style="font-size:13px;color:#666;margin-top:8px;"></div>
  </div>

  <!-- 気温チャート -->
  <div class="chart-panel">
    <h2>日別気温推移（東広島市 2025年）</h2>
    <div class="chart-container"><canvas id="tempChart"></canvas></div>
  </div>

  <!-- 積算温度チャート -->
  <div class="chart-panel">
    <h2>有効積算温度と通知ポイント</h2>
    <div class="chart-container"><canvas id="accChart"></canvas></div>
  </div>

  <!-- 通知タイムライン -->
  <div class="timeline">
    <h2>通知タイムライン（全 <span id="notifCount"></span> 件）</h2>
    <div id="notifList"></div>
  </div>

  <!-- LINE プレビュー -->
  <div style="display:flex;gap:16px;flex-wrap:wrap;">
    <div class="line-preview" style="flex:1;">
      <h2>LINE 通知プレビュー（クリックで切替）</h2>
      <div class="line-bubble" id="lineBubble">通知をクリックしてください</div>
    </div>
  </div>

</div>

<div class="footer">
  たんぼアドバイザー v1.0 シミュレーションデモ | 東広島市 2025年 コシヒカリ
</div>

<script>
const DATA = [{"date": "2025-06-02", "avg_temp": 21.0, "max_temp": 24.1, "min_temp": 16.7, "water_temp": 18.0, "humidity": 74.5, "acc_temp": 0, "stage": "田植え前", "days": 0}, {"date": "2025-06-03", "avg_temp": 21.5, "max_temp": 24.2, "min_temp": 17.3, "water_temp": 18.8, "humidity": 83.9, "acc_temp": 0, "stage": "田植え前", "days": 0}, {"date": "2025-06-04", "avg_temp": 21.0, "max_temp": 25.5, "min_temp": 17.9, "water_temp": 18.4, "humidity": 84.0, "acc_temp": 0, "stage": "田植え前", "days": 0}, {"date": "2025-06-05", "avg_temp": 22.6, "max_temp": 27.1, "min_temp": 18.0, "water_temp": 19.3, "humidity": 75.0, "acc_temp": 12.6, "stage": "分げつ期", "days": 0}, {"date": "2025-06-06", "avg_temp": 18.6, "max_temp": 29.3, "min_temp": 15.4, "water_temp": 16.6, "humidity": 73.8, "acc_temp": 21.2, "stage": "分げつ期", "days": 1}, {"date": "2025-06-07", "avg_temp": 16.2, "max_temp": 23.0, "min_temp": 8.0, "water_temp": 11.0, "humidity": 80.6, "acc_temp": 27.4, "stage": "分げつ期", "days": 2}, {"date": "2025-06-08", "avg_temp": 17.4, "max_temp": 26.0, "min_temp": 10.8, "water_temp": 13.5, "humidity": 76.8, "acc_temp": 34.8, "stage": "分げつ期", "days": 3}, {"date": "2025-06-09", "avg_temp": 16.7, "max_temp": 25.4, "min_temp": 12.1, "water_temp": 13.5, "humidity": 75.6, "acc_temp": 41.5, "stage": "分げつ期", "days": 4}, {"date": "2025-06-10", "avg_temp": 20.6, "max_temp": 27.4, "min_temp": 17.3, "water_temp": 18.1, "humidity": 84.8, "acc_temp": 52.1, "stage": "分げつ期", "days": 5}, {"date": "2025-06-11", "avg_temp": 20.8, "max_temp": 29.1, "min_temp": 18.0, "water_temp": 19.2, "humidity": 92.1, "acc_temp": 62.9, "stage": "分げつ期", "days": 6}, {"date": "2025-06-12", "avg_temp": 20.8, "max_temp": 27.2, "min_temp": 18.0, "water_temp": 19.0, "humidity": 88.6, "acc_temp": 73.7, "stage": "分げつ期", "days": 7}, {"date": "2025-06-13", "avg_temp": 19.8, "max_temp": 27.7, "min_temp": 17.7, "water_temp": 18.8, "humidity": 97.4, "acc_temp": 83.5, "stage": "分げつ期", "days": 8}, {"date": "2025-06-14", "avg_temp": 19.6, "max_temp": 26.9, "min_temp": 17.3, "water_temp": 17.8, "humidity": 82.7, "acc_temp": 93.1, "stage": "分げつ期", "days": 9}, {"date": "2025-06-15", "avg_temp": 19.9, "max_temp": 27.5, "min_temp": 19.2, "water_temp": 19.9, "humidity": 89.8, "acc_temp": 103.0, "stage": "分げつ期", "days": 10}, {"date": "2025-06-16", "avg_temp": 21.1, "max_temp": 26.1, "min_temp": 16.7, "water_temp": 18.8, "humidity": 79.7, "acc_temp": 114.1, "stage": "分げつ期", "days": 11}, {"date": "2025-06-17", "avg_temp": 22.3, "max_temp": 27.7, "min_temp": 16.5, "water_temp": 17.8, "humidity": 75.2, "acc_temp": 126.4, "stage": "分げつ期", "days": 12}, {"date": "2025-06-18", "avg_temp": 21.2, "max_temp": 26.2, "min_temp": 17.9, "water_temp": 18.9, "humidity": 73.7, "acc_temp": 137.6, "stage": "分げつ期", "days": 13}, {"date": "2025-06-19", "avg_temp": 20.2, "max_temp": 29.9, "min_temp": 19.3, "water_temp": 19.4, "humidity": 91.1, "acc_temp": 147.8, "stage": "分げつ期", "days": 14}, {"date": "2025-06-20", "avg_temp": 20.6, "max_temp": 28.7, "min_temp": 19.9, "water_temp": 20.4, "humidity": 80.6, "acc_temp": 158.4, "stage": "分げつ期", "days": 15}, {"date": "2025-06-21", "avg_temp": 20.4, "max_temp": 25.4, "min_temp": 18.7, "water_temp": 19.6, "humidity": 82.6, "acc_temp": 168.8, "stage": "分げつ期", "days": 16}, {"date": "2025-06-22", "avg_temp": 19.4, "max_temp": 26.0, "min_temp": 17.7, "water_temp": 18.2, "humidity": 94.0, "acc_temp": 178.2, "stage": "分げつ期", "days": 17}, {"date": "2025-06-23", "avg_temp": 20.9, "max_temp": 27.3, "min_temp": 18.2, "water_temp": 19.7, "humidity": 95.8, "acc_temp": 189.1, "stage": "分げつ期", "days": 18}, {"date": "2025-06-24", "avg_temp": 20.6, "max_temp": 28.1, "min_temp": 18.6, "water_temp": 19.1, "humidity": 87.2, "acc_temp": 199.7, "stage": "分げつ期", "days": 19}, {"date": "2025-06-25", "avg_temp": 22.5, "max_temp": 26.8, "min_temp": 17.0, "water_temp": 18.5, "humidity": 74.1, "acc_temp": 212.2, "stage": "分げつ期", "days": 20}, {"date": "2025-06-26", "avg_temp": 22.4, "max_temp": 28.2, "min_temp": 18.8, "water_temp": 19.7, "humidity": 78.1, "acc_temp": 224.6, "stage": "分げつ期", "days": 21}, {"date": "2025-06-27", "avg_temp": 23.8, "max_temp": 28.3, "min_temp": 20.4, "water_temp": 21.3, "humidity": 81.4, "acc_temp": 238.4, "stage": "分げつ期", "days": 22}, {"date": "2025-06-28", "avg_temp": 21.0, "max_temp": 29.2, "min_temp": 19.3, "water_temp": 19.9, "humidity": 89.1, "acc_temp": 249.4, "stage": "分げつ期", "days": 23}, {"date": "2025-06-29", "avg_temp": 21.7, "max_temp": 27.8, "min_temp": 18.7, "water_temp": 18.9, "humidity": 88.9, "acc_temp": 261.1, "stage": "分げつ期", "days": 24}, {"date": "2025-06-30", "avg_temp": 21.9, "max_temp": 27.2, "min_temp": 19.0, "water_temp": 20.0, "humidity": 71.6, "acc_temp": 273.0, "stage": "分げつ期", "days": 25}, {"date": "2025-07-01", "avg_temp": 23.8, "max_temp": 30.0, "min_temp": 21.5, "water_temp": 23.2, "humidity": 88.8, "acc_temp": 286.8, "stage": "分げつ期", "days": 26}, {"date": "2025-07-02", "avg_temp": 23.9, "max_temp": 31.9, "min_temp": 21.9, "water_temp": 21.9, "humidity": 86.3, "acc_temp": 300.7, "stage": "分げつ期", "days": 27}, {"date": "2025-07-03", "avg_temp": 25.2, "max_temp": 32.5, "min_temp": 23.1, "water_temp": 23.0, "humidity": 88.5, "acc_temp": 315.9, "stage": "分げつ期", "days": 28}, {"date": "2025-07-04", "avg_temp": 24.3, "max_temp": 31.7, "min_temp": 23.0, "water_temp": 23.1, "humidity": 85.5, "acc_temp": 330.2, "stage": "分げつ期", "days": 29}, {"date": "2025-07-05", "avg_temp": 25.0, "max_temp": 30.8, "min_temp": 21.5, "water_temp": 22.1, "humidity": 84.9, "acc_temp": 345.2, "stage": "分げつ期", "days": 30}, {"date": "2025-07-06", "avg_temp": 24.6, "max_temp": 30.1, "min_temp": 20.9, "water_temp": 21.9, "humidity": 78.9, "acc_temp": 359.8, "stage": "最高分げつ期", "days": 31}, {"date": "2025-07-07", "avg_temp": 25.5, "max_temp": 30.9, "min_temp": 21.6, "water_temp": 23.0, "humidity": 82.0, "acc_temp": 375.3, "stage": "最高分げつ期", "days": 32}, {"date": "2025-07-08", "avg_temp": 27.8, "max_temp": 32.8, "min_temp": 24.6, "water_temp": 26.4, "humidity": 76.6, "acc_temp": 393.1, "stage": "最高分げつ期", "days": 33}, {"date": "2025-07-09", "avg_temp": 23.8, "max_temp": 32.0, "min_temp": 22.3, "water_temp": 22.2, "humidity": 88.2, "acc_temp": 406.9, "stage": "最高分げつ期", "days": 34}, {"date": "2025-07-10", "avg_temp": 25.6, "max_temp": 28.8, "min_temp": 22.1, "water_temp": 22.9, "humidity": 79.6, "acc_temp": 422.5, "stage": "最高分げつ期", "days": 35}, {"date": "2025-07-11", "avg_temp": 25.6, "max_temp": 31.1, "min_temp": 21.1, "water_temp": 22.8, "humidity": 72.6, "acc_temp": 438.1, "stage": "最高分げつ期", "days": 36}, {"date": "2025-07-12", "avg_temp": 28.3, "max_temp": 33.3, "min_temp": 24.4, "water_temp": 26.6, "humidity": 79.6, "acc_temp": 456.4, "stage": "最高分げつ期", "days": 37}, {"date": "2025-07-13", "avg_temp": 23.5, "max_temp": 31.2, "min_temp": 22.9, "water_temp": 23.4, "humidity": 89.2, "acc_temp": 469.9, "stage": "最高分げつ期", "days": 38}, {"date": "2025-07-14", "avg_temp": 25.9, "max_temp": 32.7, "min_temp": 21.5, "water_temp": 22.9, "humidity": 92.1, "acc_temp": 485.8, "stage": "最高分げつ期", "days": 39}, {"date": "2025-07-15", "avg_temp": 25.1, "max_temp": 30.6, "min_temp": 22.4, "water_temp": 22.7, "humidity": 91.7, "acc_temp": 500.9, "stage": "中干し適期", "days": 40}, {"date": "2025-07-16", "avg_temp": 26.2, "max_temp": 30.7, "min_temp": 20.6, "water_temp": 22.4, "humidity": 77.4, "acc_temp": 517.1, "stage": "中干し適期", "days": 41}, {"date": "2025-07-17", "avg_temp": 27.2, "max_temp": 32.5, "min_temp": 24.5, "water_temp": 25.9, "humidity": 83.0, "acc_temp": 534.3, "stage": "中干し適期", "days": 42}, {"date": "2025-07-18", "avg_temp": 26.3, "max_temp": 30.0, "min_temp": 21.9, "water_temp": 23.0, "humidity": 76.9, "acc_temp": 550.6, "stage": "中干し適期", "days": 43}, {"date": "2025-07-19", "avg_temp": 24.6, "max_temp": 29.6, "min_temp": 21.3, "water_temp": 21.7, "humidity": 80.4, "acc_temp": 565.2, "stage": "中干し適期", "days": 44}, {"date": "2025-07-20", "avg_temp": 27.0, "max_temp": 34.1, "min_temp": 22.3, "water_temp": 23.4, "humidity": 73.4, "acc_temp": 582.2, "stage": "中干し適期", "days": 45}, {"date": "2025-07-21", "avg_temp": 25.5, "max_temp": 31.1, "min_temp": 21.2, "water_temp": 23.4, "humidity": 84.7, "acc_temp": 597.7, "stage": "中干し適期", "days": 46}, {"date": "2025-07-22", "avg_temp": 28.3, "max_temp": 33.1, "min_temp": 25.7, "water_temp": 26.1, "humidity": 78.0, "acc_temp": 616.0, "stage": "中干し適期", "days": 47}, {"date": "2025-07-23", "avg_temp": 27.8, "max_temp": 31.8, "min_temp": 23.8, "water_temp": 26.2, "humidity": 88.6, "acc_temp": 633.8, "stage": "中干し適期", "days": 48}, {"date": "2025-07-24", "avg_temp": 27.9, "max_temp": 35.5, "min_temp": 24.0, "water_temp": 26.0, "humidity": 78.2, "acc_temp": 651.7, "stage": "幼穂形成期", "days": 49}, {"date": "2025-07-25", "avg_temp": 26.6, "max_temp": 32.4, "min_temp": 24.0, "water_temp": 25.0, "humidity": 85.8, "acc_temp": 668.3, "stage": "幼穂形成期", "days": 50}, {"date": "2025-07-26", "avg_temp": 26.1, "max_temp": 29.9, "min_temp": 23.4, "water_temp": 24.0, "humidity": 80.7, "acc_temp": 684.4, "stage": "幼穂形成期", "days": 51}, {"date": "2025-07-27", "avg_temp": 27.4, "max_temp": 35.5, "min_temp": 23.3, "water_temp": 25.0, "humidity": 80.2, "acc_temp": 701.8, "stage": "幼穂形成期", "days": 52}, {"date": "2025-07-28", "avg_temp": 26.1, "max_temp": 31.6, "min_temp": 22.8, "water_temp": 24.3, "humidity": 81.5, "acc_temp": 717.9, "stage": "幼穂形成期", "days": 53}, {"date": "2025-07-29", "avg_temp": 24.2, "max_temp": 30.0, "min_temp": 20.5, "water_temp": 22.0, "humidity": 87.9, "acc_temp": 732.1, "stage": "幼穂形成期", "days": 54}, {"date": "2025-07-30", "avg_temp": 28.2, "max_temp": 33.8, "min_temp": 24.4, "water_temp": 25.2, "humidity": 65.8, "acc_temp": 750.3, "stage": "幼穂形成期", "days": 55}, {"date": "2025-07-31", "avg_temp": 26.2, "max_temp": 30.3, "min_temp": 23.1, "water_temp": 24.2, "humidity": 80.7, "acc_temp": 766.5, "stage": "幼穂形成期", "days": 56}, {"date": "2025-08-01", "avg_temp": 27.7, "max_temp": 36.2, "min_temp": 24.4, "water_temp": 25.8, "humidity": 73.6, "acc_temp": 784.2, "stage": "幼穂形成期", "days": 57}, {"date": "2025-08-02", "avg_temp": 27.6, "max_temp": 33.9, "min_temp": 24.5, "water_temp": 25.5, "humidity": 79.2, "acc_temp": 801.8, "stage": "穂ばらみ期", "days": 58}, {"date": "2025-08-03", "avg_temp": 27.3, "max_temp": 31.9, "min_temp": 23.2, "water_temp": 24.4, "humidity": 72.6, "acc_temp": 819.1, "stage": "穂ばらみ期", "days": 59}, {"date": "2025-08-04", "avg_temp": 29.0, "max_temp": 35.5, "min_temp": 23.7, "water_temp": 25.3, "humidity": 79.4, "acc_temp": 838.1, "stage": "穂ばらみ期", "days": 60}, {"date": "2025-08-05", "avg_temp": 28.3, "max_temp": 34.3, "min_temp": 25.0, "water_temp": 26.3, "humidity": 81.1, "acc_temp": 856.4, "stage": "穂ばらみ期", "days": 61}, {"date": "2025-08-06", "avg_temp": 26.7, "max_temp": 33.3, "min_temp": 23.2, "water_temp": 24.0, "humidity": 72.6, "acc_temp": 873.1, "stage": "穂ばらみ期", "days": 62}, {"date": "2025-08-07", "avg_temp": 27.1, "max_temp": 30.7, "min_temp": 23.1, "water_temp": 24.6, "humidity": 72.2, "acc_temp": 890.2, "stage": "穂ばらみ期", "days": 63}, {"date": "2025-08-08", "avg_temp": 25.8, "max_temp": 29.2, "min_temp": 21.3, "water_temp": 22.3, "humidity": 78.2, "acc_temp": 906.0, "stage": "穂ばらみ期", "days": 64}, {"date": "2025-08-09", "avg_temp": 25.4, "max_temp": 29.4, "min_temp": 22.2, "water_temp": 23.9, "humidity": 70.6, "acc_temp": 921.4, "stage": "穂ばらみ期", "days": 65}, {"date": "2025-08-10", "avg_temp": 26.2, "max_temp": 30.2, "min_temp": 23.4, "water_temp": 25.2, "humidity": 81.3, "acc_temp": 937.6, "stage": "穂ばらみ期", "days": 66}, {"date": "2025-08-11", "avg_temp": 26.2, "max_temp": 33.0, "min_temp": 21.1, "water_temp": 22.5, "humidity": 81.1, "acc_temp": 953.8, "stage": "出穂期", "days": 67}, {"date": "2025-08-12", "avg_temp": 29.2, "max_temp": 36.3, "min_temp": 22.6, "water_temp": 25.5, "humidity": 74.8, "acc_temp": 973.0, "stage": "出穂期", "days": 68}, {"date": "2025-08-13", "avg_temp": 27.4, "max_temp": 32.6, "min_temp": 24.5, "water_temp": 25.3, "humidity": 78.3, "acc_temp": 990.4, "stage": "出穂期", "days": 69}, {"date": "2025-08-14", "avg_temp": 26.7, "max_temp": 32.0, "min_temp": 21.8, "water_temp": 22.5, "humidity": 72.7, "acc_temp": 1007.1, "stage": "出穂期", "days": 70}, {"date": "2025-08-15", "avg_temp": 26.3, "max_temp": 32.9, "min_temp": 21.3, "water_temp": 22.7, "humidity": 76.3, "acc_temp": 1023.4, "stage": "出穂期", "days": 71}, {"date": "2025-08-16", "avg_temp": 26.4, "max_temp": 32.0, "min_temp": 23.3, "water_temp": 24.8, "humidity": 72.9, "acc_temp": 1039.8, "stage": "出穂期", "days": 72}, {"date": "2025-08-17", "avg_temp": 26.0, "max_temp": 30.1, "min_temp": 22.3, "water_temp": 23.4, "humidity": 61.4, "acc_temp": 1055.8, "stage": "出穂期", "days": 73}, {"date": "2025-08-18", "avg_temp": 24.8, "max_temp": 29.9, "min_temp": 20.4, "water_temp": 21.7, "humidity": 82.2, "acc_temp": 1070.6, "stage": "出穂期", "days": 74}, {"date": "2025-08-19", "avg_temp": 24.4, "max_temp": 28.5, "min_temp": 21.4, "water_temp": 22.1, "humidity": 78.4, "acc_temp": 1085.0, "stage": "出穂期", "days": 75}, {"date": "2025-08-20", "avg_temp": 25.3, "max_temp": 31.1, "min_temp": 21.0, "water_temp": 21.9, "humidity": 83.7, "acc_temp": 1100.3, "stage": "登熟期", "days": 76}, {"date": "2025-08-21", "avg_temp": 25.7, "max_temp": 30.9, "min_temp": 22.4, "water_temp": 23.8, "humidity": 69.6, "acc_temp": 1116.0, "stage": "登熟期", "days": 77}, {"date": "2025-08-22", "avg_temp": 26.6, "max_temp": 31.1, "min_temp": 21.9, "water_temp": 22.8, "humidity": 71.5, "acc_temp": 1132.6, "stage": "登熟期", "days": 78}, {"date": "2025-08-23", "avg_temp": 24.8, "max_temp": 31.0, "min_temp": 20.2, "water_temp": 21.9, "humidity": 77.3, "acc_temp": 1147.4, "stage": "登熟期", "days": 79}, {"date": "2025-08-24", "avg_temp": 25.3, "max_temp": 29.4, "min_temp": 20.4, "water_temp": 21.4, "humidity": 71.7, "acc_temp": 1162.7, "stage": "登熟期", "days": 80}, {"date": "2025-08-25", "avg_temp": 25.2, "max_temp": 29.6, "min_temp": 22.4, "water_temp": 22.5, "humidity": 76.9, "acc_temp": 1177.9, "stage": "登熟期", "days": 81}, {"date": "2025-08-26", "avg_temp": 21.7, "max_temp": 30.9, "min_temp": 22.1, "water_temp": 22.6, "humidity": 88.1, "acc_temp": 1189.6, "stage": "登熟期", "days": 82}, {"date": "2025-08-27", "avg_temp": 21.5, "max_temp": 31.3, "min_temp": 21.3, "water_temp": 20.3, "humidity": 83.6, "acc_temp": 1201.1, "stage": "登熟期", "days": 83}, {"date": "2025-08-28", "avg_temp": 21.3, "max_temp": 30.2, "min_temp": 22.7, "water_temp": 21.9, "humidity": 85.7, "acc_temp": 1212.4, "stage": "登熟期", "days": 84}, {"date": "2025-08-29", "avg_temp": 25.8, "max_temp": 31.3, "min_temp": 21.8, "water_temp": 24.0, "humidity": 86.5, "acc_temp": 1228.2, "stage": "登熟期", "days": 85}, {"date": "2025-08-30", "avg_temp": 25.2, "max_temp": 30.2, "min_temp": 20.6, "water_temp": 22.0, "humidity": 69.9, "acc_temp": 1243.4, "stage": "登熟期", "days": 86}, {"date": "2025-08-31", "avg_temp": 27.0, "max_temp": 32.3, "min_temp": 22.3, "water_temp": 23.3, "humidity": 72.2, "acc_temp": 1260.4, "stage": "登熟期", "days": 87}, {"date": "2025-09-01", "avg_temp": 23.1, "max_temp": 27.4, "min_temp": 19.7, "water_temp": 21.0, "humidity": 71.4, "acc_temp": 1273.5, "stage": "登熟期", "days": 88}, {"date": "2025-09-02", "avg_temp": 22.5, "max_temp": 27.3, "min_temp": 17.7, "water_temp": 19.3, "humidity": 77.0, "acc_temp": 1286.0, "stage": "登熟期", "days": 89}, {"date": "2025-09-03", "avg_temp": 19.6, "max_temp": 28.8, "min_temp": 22.1, "water_temp": 21.5, "humidity": 95.4, "acc_temp": 1295.6, "stage": "登熟期", "days": 90}, {"date": "2025-09-04", "avg_temp": 20.8, "max_temp": 29.0, "min_temp": 19.1, "water_temp": 20.0, "humidity": 91.7, "acc_temp": 1306.4, "stage": "登熟期", "days": 91}, {"date": "2025-09-05", "avg_temp": 21.7, "max_temp": 27.7, "min_temp": 17.8, "water_temp": 19.7, "humidity": 74.6, "acc_temp": 1318.1, "stage": "登熟期", "days": 92}, {"date": "2025-09-06", "avg_temp": 21.5, "max_temp": 26.2, "min_temp": 16.0, "water_temp": 18.2, "humidity": 82.3, "acc_temp": 1329.6, "stage": "登熟期", "days": 93}, {"date": "2025-09-07", "avg_temp": 22.6, "max_temp": 27.7, "min_temp": 19.2, "water_temp": 20.9, "humidity": 79.6, "acc_temp": 1342.2, "stage": "登熟期", "days": 94}, {"date": "2025-09-08", "avg_temp": 21.4, "max_temp": 27.3, "min_temp": 16.2, "water_temp": 17.5, "humidity": 80.9, "acc_temp": 1353.6, "stage": "登熟期", "days": 95}, {"date": "2025-09-09", "avg_temp": 20.5, "max_temp": 24.9, "min_temp": 15.5, "water_temp": 17.5, "humidity": 76.3, "acc_temp": 1364.1, "stage": "登熟期", "days": 96}, {"date": "2025-09-10", "avg_temp": 20.8, "max_temp": 26.2, "min_temp": 16.1, "water_temp": 17.3, "humidity": 84.2, "acc_temp": 1374.9, "stage": "登熟期", "days": 97}, {"date": "2025-09-11", "avg_temp": 21.3, "max_temp": 27.1, "min_temp": 17.5, "water_temp": 18.4, "humidity": 78.1, "acc_temp": 1386.2, "stage": "登熟期", "days": 98}, {"date": "2025-09-12", "avg_temp": 21.6, "max_temp": 24.8, "min_temp": 17.1, "water_temp": 18.2, "humidity": 75.5, "acc_temp": 1397.8, "stage": "登熟期", "days": 99}, {"date": "2025-09-13", "avg_temp": 22.7, "max_temp": 25.7, "min_temp": 18.7, "water_temp": 19.9, "humidity": 82.4, "acc_temp": 1410.5, "stage": "登熟期", "days": 100}, {"date": "2025-09-14", "avg_temp": 21.2, "max_temp": 26.9, "min_temp": 17.4, "water_temp": 18.7, "humidity": 75.9, "acc_temp": 1421.7, "stage": "登熟期", "days": 101}, {"date": "2025-09-15", "avg_temp": 22.0, "max_temp": 28.6, "min_temp": 17.7, "water_temp": 19.6, "humidity": 78.8, "acc_temp": 1433.7, "stage": "登熟期", "days": 102}, {"date": "2025-09-16", "avg_temp": 22.5, "max_temp": 28.5, "min_temp": 18.7, "water_temp": 20.4, "humidity": 86.2, "acc_temp": 1446.2, "stage": "登熟期", "days": 103}, {"date": "2025-09-17", "avg_temp": 21.8, "max_temp": 28.4, "min_temp": 17.3, "water_temp": 18.6, "humidity": 83.4, "acc_temp": 1458.0, "stage": "登熟期", "days": 104}, {"date": "2025-09-18", "avg_temp": 20.9, "max_temp": 26.5, "min_temp": 16.7, "water_temp": 17.8, "humidity": 84.2, "acc_temp": 1468.9, "stage": "登熟期", "days": 105}, {"date": "2025-09-19", "avg_temp": 21.7, "max_temp": 27.2, "min_temp": 19.2, "water_temp": 19.9, "humidity": 83.4, "acc_temp": 1480.6, "stage": "登熟期", "days": 106}, {"date": "2025-09-20", "avg_temp": 22.6, "max_temp": 28.6, "min_temp": 19.6, "water_temp": 20.9, "humidity": 81.8, "acc_temp": 1493.2, "stage": "登熟期", "days": 107}, {"date": "2025-09-21", "avg_temp": 22.1, "max_temp": 27.4, "min_temp": 17.3, "water_temp": 18.9, "humidity": 72.8, "acc_temp": 1505.3, "stage": "登熟期", "days": 108}, {"date": "2025-09-22", "avg_temp": 20.2, "max_temp": 25.0, "min_temp": 15.7, "water_temp": 16.7, "humidity": 81.8, "acc_temp": 1515.5, "stage": "登熟期", "days": 109}, {"date": "2025-09-23", "avg_temp": 23.9, "max_temp": 29.4, "min_temp": 20.1, "water_temp": 21.2, "humidity": 79.5, "acc_temp": 1529.4, "stage": "登熟期", "days": 110}, {"date": "2025-09-24", "avg_temp": 21.3, "max_temp": 26.4, "min_temp": 15.7, "water_temp": 17.2, "humidity": 71.1, "acc_temp": 1540.7, "stage": "登熟期", "days": 111}, {"date": "2025-09-25", "avg_temp": 21.2, "max_temp": 28.0, "min_temp": 16.0, "water_temp": 17.8, "humidity": 71.9, "acc_temp": 1551.9, "stage": "登熟期", "days": 112}, {"date": "2025-09-26", "avg_temp": 22.7, "max_temp": 27.6, "min_temp": 16.6, "water_temp": 18.4, "humidity": 83.5, "acc_temp": 1564.6, "stage": "登熟期", "days": 113}, {"date": "2025-09-27", "avg_temp": 21.4, "max_temp": 26.3, "min_temp": 15.8, "water_temp": 16.2, "humidity": 75.0, "acc_temp": 1576.0, "stage": "登熟期", "days": 114}, {"date": "2025-09-28", "avg_temp": 20.1, "max_temp": 26.3, "min_temp": 15.6, "water_temp": 17.3, "humidity": 81.6, "acc_temp": 1586.1, "stage": "登熟期", "days": 115}, {"date": "2025-09-29", "avg_temp": 19.7, "max_temp": 24.4, "min_temp": 16.1, "water_temp": 17.3, "humidity": 72.2, "acc_temp": 1595.8, "stage": "登熟期", "days": 116}, {"date": "2025-09-30", "avg_temp": 20.4, "max_temp": 27.1, "min_temp": 17.1, "water_temp": 17.6, "humidity": 73.4, "acc_temp": 1606.2, "stage": "成熟期", "days": 117}, {"date": "2025-10-01", "avg_temp": 16.6, "max_temp": 23.1, "min_temp": 12.1, "water_temp": 13.4, "humidity": 80.2, "acc_temp": 1612.8, "stage": "成熟期", "days": 118}, {"date": "2025-10-02", "avg_temp": 15.3, "max_temp": 22.0, "min_temp": 10.0, "water_temp": 12.0, "humidity": 66.8, "acc_temp": 1618.1, "stage": "成熟期", "days": 119}, {"date": "2025-10-03", "avg_temp": 15.7, "max_temp": 20.8, "min_temp": 10.3, "water_temp": 11.8, "humidity": 74.5, "acc_temp": 1623.8, "stage": "成熟期", "days": 120}, {"date": "2025-10-04", "avg_temp": 15.2, "max_temp": 21.4, "min_temp": 11.1, "water_temp": 11.8, "humidity": 62.8, "acc_temp": 1629.0, "stage": "成熟期", "days": 121}, {"date": "2025-10-05", "avg_temp": 15.3, "max_temp": 21.9, "min_temp": 11.2, "water_temp": 13.4, "humidity": 68.5, "acc_temp": 1634.3, "stage": "成熟期", "days": 122}, {"date": "2025-10-06", "avg_temp": 15.8, "max_temp": 21.1, "min_temp": 9.4, "water_temp": 11.5, "humidity": 72.7, "acc_temp": 1640.1, "stage": "成熟期", "days": 123}, {"date": "2025-10-07", "avg_temp": 17.0, "max_temp": 21.6, "min_temp": 13.3, "water_temp": 14.5, "humidity": 68.4, "acc_temp": 1647.1, "stage": "成熟期", "days": 124}, {"date": "2025-10-08", "avg_temp": 17.1, "max_temp": 23.1, "min_temp": 12.2, "water_temp": 12.6, "humidity": 69.0, "acc_temp": 1654.2, "stage": "成熟期", "days": 125}, {"date": "2025-10-09", "avg_temp": 17.9, "max_temp": 22.8, "min_temp": 12.4, "water_temp": 14.7, "humidity": 78.8, "acc_temp": 1662.1, "stage": "成熟期", "days": 126}, {"date": "2025-10-10", "avg_temp": 17.6, "max_temp": 23.0, "min_temp": 11.5, "water_temp": 13.5, "humidity": 77.3, "acc_temp": 1669.7, "stage": "成熟期", "days": 127}, {"date": "2025-10-11", "avg_temp": 16.4, "max_temp": 23.3, "min_temp": 11.8, "water_temp": 13.7, "humidity": 63.9, "acc_temp": 1676.1, "stage": "成熟期", "days": 128}, {"date": "2025-10-12", "avg_temp": 16.5, "max_temp": 23.4, "min_temp": 11.7, "water_temp": 12.6, "humidity": 66.4, "acc_temp": 1682.6, "stage": "成熟期", "days": 129}, {"date": "2025-10-13", "avg_temp": 17.1, "max_temp": 22.3, "min_temp": 12.1, "water_temp": 13.4, "humidity": 78.9, "acc_temp": 1689.7, "stage": "成熟期", "days": 130}, {"date": "2025-10-14", "avg_temp": 16.3, "max_temp": 22.6, "min_temp": 11.1, "water_temp": 12.9, "humidity": 63.9, "acc_temp": 1696.0, "stage": "成熟期", "days": 131}, {"date": "2025-10-15", "avg_temp": 15.8, "max_temp": 21.3, "min_temp": 10.4, "water_temp": 10.8, "humidity": 83.2, "acc_temp": 1701.8, "stage": "成熟期", "days": 132}];
const NOTIFS = [{"date": "2025-06-07", "type": "water_temp", "level": "warning", "title": "活着注意：水温低下", "detail": "水温11.0℃。15℃以下は活着遅延のおそれ。深水管理(5-7cm)で保温してください。", "acc_temp": 27.4}, {"date": "2025-07-08", "type": "drain_pre", "level": "info", "title": "中干し予告：あと約6日", "detail": "積算温度393℃日。500℃日で中干し適期。水を少しずつ減らす準備を。", "acc_temp": 393.1}, {"date": "2025-07-15", "type": "drain_start", "level": "action", "title": "中干し開始", "detail": "積算温度501℃日。中干しを始めてください。期間7-10日。07/12までに完了。", "acc_temp": 500.9}, {"date": "2025-07-22", "type": "drain_end", "level": "action", "title": "中干し終了→間断かんがい", "detail": "中干し7日目。出穂前に間に合わせるため終了。水を入れて間断かんがいに切り替えてください。", "acc_temp": 616.0}, {"date": "2025-07-24", "type": "blast_risk", "level": "warning", "title": "いもち病注意（幼穂形成期）", "detail": "穂いもち危険期。高湿度24h連続。気温27.9℃。予防散布を検討。", "acc_temp": 651.7}, {"date": "2025-08-11", "type": "heading", "level": "info", "title": "出穂を確認", "detail": "積算温度954℃日。出穂期に入りました。今後20日間の高温に注意。穂いもち防除を。", "acc_temp": 953.8}, {"date": "2025-08-14", "type": "heat_stress_mod", "level": "info", "title": "高温障害注意：やや高温", "detail": "出穂後3日。平均気温27.8℃(夜温23.0℃)。水管理を注意深く。", "acc_temp": 1007.1}, {"date": "2025-08-14", "type": "heat_stress", "level": "warning", "title": "高温障害リスク：高", "detail": "出穂後3日。平均気温27.8℃(夜温23.0℃)。掛け流しかんがい・夜間入水を。", "acc_temp": 1007.1}, {"date": "2025-09-08", "type": "final_drain", "level": "action", "title": "落水準備", "detail": "推定収穫09/22。落水推奨09/12頃。出穂後積算680℃日/1000℃日。", "acc_temp": 1353.6}];
const STAGES = [{"key": "tillering", "low": 0, "high": 350, "label": "分げつ期", "color": "#a8d8a8"}, {"key": "max_tiller", "low": 350, "high": 500, "label": "最高分げつ期", "color": "#7bc87b"}, {"key": "midseason_drain", "low": 500, "high": 650, "label": "中干し適期", "color": "#d4a84e"}, {"key": "panicle_form", "low": 650, "high": 800, "label": "幼穂形成期", "color": "#e8c96e"}, {"key": "booting", "low": 800, "high": 950, "label": "穂ばらみ期", "color": "#f0d890"}, {"key": "heading", "low": 950, "high": 1100, "label": "出穂期", "color": "#f5a0a0"}, {"key": "grain_filling", "low": 1100, "high": 1600, "label": "登熟期", "color": "#f0c0a0"}, {"key": "maturity", "low": 1600, "high": 2200, "label": "成熟期", "color": "#c8a878"}];
const TRANSPLANT = "2025-06-05";
const HEADING = "2025-08-11";

// 最新データ
const latest = DATA[DATA.length - 1];
const latestNotif = NOTIFS[NOTIFS.length - 1];

// 概要カード
document.getElementById("infoBar").innerHTML = `
  <div class="info-card">
    <div class="label">圃場</div>
    <div class="value">家の前の田</div>
    <div class="sub">コシヒカリ｜3,000m²</div>
  </div>
  <div class="info-card">
    <div class="label">田植えからの日数</div>
    <div class="value">${latest.days}日目</div>
    <div class="sub">田植え ${TRANSPLANT}</div>
  </div>
  <div class="info-card">
    <div class="label">有効積算温度</div>
    <div class="value">${latest.acc_temp.toFixed(0)} ℃日</div>
    <div class="sub">${latest.stage}</div>
  </div>
  <div class="info-card">
    <div class="label">今日の気温</div>
    <div class="value">${latest.avg_temp}℃</div>
    <div class="sub">最高${latest.max_temp}℃ / 最低${latest.min_temp}℃</div>
  </div>
`;

// 生育ステージバー
const maxAcc = Math.max(...DATA.map(d=>d.acc_temp));
const stageBar = document.getElementById("stageBar");
STAGES.forEach(s => {
  const seg = document.createElement("div");
  seg.className = "stage-seg" + (latest.stage === s.label ? " active" : "");
  const width = (s.high - s.low) / Math.max(maxAcc, s.high) * 100;
  seg.style.flex = width;
  seg.style.background = s.color;
  seg.textContent = s.label;
  stageBar.appendChild(seg);
});
document.getElementById("stageDetail").textContent =
  `現在: ${latest.stage}（${latest.acc_temp.toFixed(0)}℃日 / 田植え${latest.days}日目）`;

// 気温チャート
const tempCtx = document.getElementById("tempChart").getContext("2d");
new Chart(tempCtx, {
  type: "line",
  data: {
    labels: DATA.map(d=>d.date),
    datasets: [
      {
        label: "日平均気温",
        data: DATA.map(d=>d.avg_temp),
        borderColor: "#333",
        borderWidth: 2,
        pointRadius: 0,
        fill: false,
      },
      {
        label: "最高気温",
        data: DATA.map(d=>d.max_temp),
        borderColor: "rgba(220,80,80,0.4)",
        borderWidth: 1,
        borderDash: [3,3],
        pointRadius: 0,
        fill: false,
      },
      {
        label: "最低気温",
        data: DATA.map(d=>d.min_temp),
        borderColor: "rgba(80,80,220,0.4)",
        borderWidth: 1,
        borderDash: [3,3],
        pointRadius: 0,
        fill: "-1",
        backgroundColor: "rgba(220,80,80,0.06)",
      },
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        type: "time",
        time: { unit: "week", displayFormats: { week: "MM/dd" } },
      },
      y: { title: { display: true, text: "℃" } }
    },
    plugins: {
      annotation: {},
    }
  }
});

// 積算温度チャート
const accCtx = document.getElementById("accChart").getContext("2d");
const accChart = new Chart(accCtx, {
  type: "line",
  data: {
    labels: DATA.map(d=>d.date),
    datasets: [
      {
        label: "有効積算温度",
        data: DATA.map(d=>d.acc_temp),
        borderColor: "#2d7a3a",
        borderWidth: 2.5,
        pointRadius: 0,
        fill: true,
        backgroundColor: "rgba(45,122,58,0.08)",
      },
      // 通知ポイント
      {
        label: "通知発火",
        data: NOTIFS.map(n => ({ x: n.date, y: n.acc_temp })),
        type: "scatter",
        pointRadius: 8,
        pointBackgroundColor: NOTIFS.map(n =>
          n.level === "warning" ? "#cc4444" :
          n.level === "action" ? "#cc8800" : "#4488cc"
        ),
        pointBorderColor: "white",
        pointBorderWidth: 2,
      },
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        type: "time",
        time: { unit: "week", displayFormats: { week: "MM/dd" } },
      },
      y: { title: { display: true, text: "℃日" }, min: 0 }
    },
  }
});

// 通知タイムライン
document.getElementById("notifCount").textContent = NOTIFS.length;
const notifList = document.getElementById("notifList");
const levelLabels = { info: "情報", warning: "警告", action: "行動" };
const levelIcons = { info: "\ud83d\udcd8", warning: "\u26a0\ufe0f", action: "\ud83d\udce2" };

NOTIFS.forEach((n, idx) => {
  const card = document.createElement("div");
  card.className = `notif-card ${n.level}`;
  card.innerHTML = `
    <div class="notif-head">
      <span class="notif-date">${n.date}</span>
      <span class="notif-badge ${n.level}">${levelLabels[n.level]}</span>
    </div>
    <div class="notif-title">${levelIcons[n.level]} ${n.title}</div>
    <div class="notif-detail">${n.detail}</div>
    <div class="notif-acc">積算温度: ${n.acc_temp.toFixed(0)}℃日</div>
  `;
  card.addEventListener("click", () => showLinePreview(n));
  notifList.appendChild(card);
});

// LINE プレビュー
function showLinePreview(n) {
  const lines = [];
  if (n.level === "warning") {
    lines.push("\u26a0\ufe0f " + n.title);
  } else if (n.level === "action") {
    lines.push("\ud83d\udce2 " + n.title);
  } else {
    lines.push("\ud83d\udcd8 " + n.title);
  }
  lines.push("");
  lines.push("\ud83c\udf3e 家の前の田（コシヒカリ）");
  lines.push("");
  lines.push(n.detail);
  lines.push("");
  lines.push("━━━━━━━━━━");
  lines.push(`積算温度: ${n.acc_temp.toFixed(0)}℃日`);
  lines.push(`${n.date}`);

  document.getElementById("lineBubble").textContent = lines.join("\n");
}

// 最初の通知をプレビュー
if (NOTIFS.length > 0) showLinePreview(NOTIFS[0]);
</script>
</body>
</html>